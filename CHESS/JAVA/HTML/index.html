<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chess</title>

<style>
table { border-collapse: collapse; margin: auto; }
td {
  width: 60px; height: 60px;
  text-align: center; font-size: 36px;
  cursor: pointer;
}
.white { background: #f0d9b5; }
.black { background: #b58863; }
.sel { outline: 3px solid red; }
.move { outline: 2px solid green; }
.last { background: rgba(255,255,0,0.3); }
</style>
</head>

<body>

<h2 id="turn" align="center">White Turn</h2>
<table id="board"></table>

<script>
const board = document.getElementById("board");
const turnText = document.getElementById("turn");

const P = {
 r:'♜', n:'♞', b:'♝', q:'♛', k:'♚', p:'♟',
 R:'♖', N:'♘', B:'♗', Q:'♕', K:'♔', P:'♙'
};

let state, whiteTurn = true, selected = null, last = null;

function reset() {
 state = [
  ['r','n','b','q','k','b','n','r'],
  ['p','p','p','p','p','p','p','p'],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['P','P','P','P','P','P','P','P'],
  ['R','N','B','Q','K','B','N','R']
 ];
 whiteTurn = true;
 selected = last = null;
 turnText.innerText = "White Turn";
 draw();
}

function color(p){ return p==""?null:(p==p.toUpperCase()?"white":"black"); }

function draw() {
 board.innerHTML = "";
 for(let r=0;r<8;r++){
  let tr = document.createElement("tr");
  for(let c=0;c<8;c++){
   let td = document.createElement("td");
   td.className = (r+c)%2?"black":"white";
   if(last && ((last.f.r==r && last.f.c==c)||(last.t.r==r && last.t.c==c)))
     td.classList.add("last");
   td.innerText = P[state[r][c]]||"";
   td.onclick = ()=>clickCell(r,c,td);
   tr.appendChild(td);
  }
  board.appendChild(tr);
 }
}

function moves(r,c,p){
 let m=[], clr=color(p), opp=clr=="white"?"black":"white", d;
 let add=(rr,cc)=>rr>=0&&rr<8&&cc>=0&&cc<8&&(!state[rr][cc]||color(state[rr][cc])==opp)&&m.push({r:rr,c:cc});

 if(p.toLowerCase()=="p"){
  d=clr=="white"?-1:1;
  if(!state[r+d][c]) add(r+d,c);
  if((clr=="white"&&r==6||clr=="black"&&r==1)&&!state[r+2*d][c]) add(r+2*d,c);
  if(state[r+d]?.[c-1]&&color(state[r+d][c-1])==opp) add(r+d,c-1);
  if(state[r+d]?.[c+1]&&color(state[r+d][c+1])==opp) add(r+d,c+1);
 }

 if("rqb".includes(p.toLowerCase())){
  [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dr,dc])=>{
   if(p.toLowerCase()=="b") return;
   let rr=r+dr,cc=c+dc;
   while(rr>=0&&rr<8&&cc>=0&&cc<8){
    if(!state[rr][cc]) m.push({r:rr,c:cc});
    else { if(color(state[rr][cc])==opp) m.push({r:rr,c:cc}); break; }
    rr+=dr; cc+=dc;
   }
  });
 }

 if("bq".includes(p.toLowerCase())){
  [[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr,dc])=>{
   let rr=r+dr,cc=c+dc;
   while(rr>=0&&rr<8&&cc>=0&&cc<8){
    if(!state[rr][cc]) m.push({r:rr,c:cc});
    else { if(color(state[rr][cc])==opp) m.push({r:rr,c:cc}); break; }
    rr+=dr; cc+=dc;
   }
  });
 }

 if(p.toLowerCase()=="n"){
  [[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]]
   .forEach(([dr,dc])=>add(r+dr,c+dc));
 }

 if(p.toLowerCase()=="k"){
  for(let dr=-1;dr<=1;dr++)
   for(let dc=-1;dc<=1;dc++)
    if(dr||dc) add(r+dr,c+dc);
 }

 return m;
}

function clickCell(r,c,el){
 document.querySelectorAll(".sel,.move").forEach(x=>x.className=x.className.replace(" sel","").replace(" move",""));

 let p = state[r][c];
 if(p && color(p)==(whiteTurn?"white":"black")){
  selected={r,c};
  el.classList.add("sel");
  moves(r,c,p).forEach(m=>{
   document.querySelector(`td[data-row]`);
   board.rows[m.r].cells[m.c].classList.add("move");
  });
 }
 else if(selected){
  let ok = moves(selected.r,selected.c,state[selected.r][selected.c])
           .some(m=>m.r==r&&m.c==c);
  if(ok){
   last={f:selected,t:{r,c}};
   state[r][c]=state[selected.r][selected.c];
   state[selected.r][selected.c]="";
   whiteTurn=!whiteTurn;
   turnText.innerText = whiteTurn?"White Turn":"Black Turn";
   draw();
  }
  selected=null;
 }
}

reset();

let btn=document.createElement("button");
btn.innerText="Reset Game";
btn.style.margin="20px auto";
btn.style.display="block";
btn.onclick=reset;
document.body.appendChild(btn);
</script>

</body>
</html>
